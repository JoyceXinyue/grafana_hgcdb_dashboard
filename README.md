# Grafana_HGCDB_Dashboard ε=ε=(<ゝω・)☆
This is a dashboard provided by [Grafana](https://github.com/grafana/grafana?tab=readme-ov-file) to monitor the HGC Postgres database. 

## Run Steps
1. Download Grafana.
2. Check and Run `create_config.py` to generate the configuration files for Grafana and connection to database.
```
python create_config.py
```
3. Run `main.py` to generate the dashboards to Grafana.
```
python main.py
```

## Download Grafana
- [Get Grafana](https://grafana.com/get)

In `Get Grafana` page, choose `OSS` instead of `Cloud`. Download the Grafana by your operating system. The version I used is `v12.0.0`.  

The default port is `localhost:3000` and the default URL is http://localhost:3000.
- default Grafana username: `admin`
- defualt Grafana password: `admin`


## Files and Folders Inventory:
- Files:
    - `main.py`: The main script to generate and upload the dashboards to Grafana.
    - `create_config.py`: The script to generate the configuration files for Grafana and connection to database.
- Folders:
    - `config_folders`: contains all the configuration files for Grafana.
    - `Create`: contains all the files to create the dashboards.
    - `preSteps`: contains all the scripts to get the API_KEY and add the database_source.
    - `tool`: contains all the scripts that are used to generate `json` files to Grafana.


## How the Scripts Work
The `preSteps` folder will only be runned for once, as there's a parameter - `GF_RUN_TIMES` - in `gf_conn.yaml` (please make sure it is set to 0 before the first time running the main.py) counting how many times the `main.py` has been runned:  
- `preSteps` folder:  
    - `get_api_key.py` is the script to create a service account and get the API_KEY for Grafana. The API_KEY will be stored in the `gf_conn.yaml` file for future usages: add datasource, create folders, and upload dashboards.
    - `add_datasource.py` is the script to add the database_source to Grafana. The database_source is called from the parameters in the `db_conn.yaml` file, which will be generated by `create_config.py`.
    - More information about [Grafana API](https://grafana.com/docs/grafana/latest/developers/http_api/)
- `create` folder:
    - `create_dashboards.py` and `create_folders.py` are the scripts to do whatever is listed in the titles. There's nothing much to talk here. Just run the scripts and the dashboards will be generated.
- `tool` folder:
    - `generate.py` is the script to handle folders and dashboards.
    - `helper.py` is the script than contain classes to load the configuration files: `ConfigLoader` and handle the API requests: `GrafanaClient`, and some other helper functions, e.g.: `create_uid`.
    - `other_builder.py` is the script to build the other featurers, e.g.: `filters`, `alerts`...
    - `panel_builder.py` is the script to build the panels for each dashboard, the panel types are: General SQL panels, and IV_Curve plot.
    - `sql_builder.py` is the script to build the SQL queries for each panel. I used `ABC` - Abstract Base Class - to build the SQL queries for different chart types. For the future developers who want to add more chart types, they can simply add a new class and implement the chart types in the `ChartSQLFactory` class. The Class is called only in: `panel_builder.py`: line 31 - line 40 to generate the SQL queries for each panel.
    - Link to [JSON MODEL](https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/view-dashboard-json-model/) for Grafana dashboards.
  
If you have any questions, please feel free to ask me, and I'm happy to hear any suggestions or improvements! 